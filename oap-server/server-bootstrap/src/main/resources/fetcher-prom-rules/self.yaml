# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

fetcherInterval: PT15S
fetcherTimeout: PT10S
metricsPath: /metrics
staticConfig:
  # targets will be labeled as "instance"
  targets:
    - localhost:1234
  labels:
    app: test-oap
metricsRules:
  - name: instance_cpu_percentage
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      process_cpu_seconds_total:
        counterFunction: RATE
        range: PT1M
        scale: 2
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_jvm_memory_bytes_used
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      jvm_memory_bytes_used:
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_jvm_gc_collection_seconds
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      jvm_gc_collection_seconds:
        relabel:
          service:
            - app
          instance:
            - instance

  - name: instance_persistence_timer_bulk_execute_latency_heatmap
    scope: SERVICE_INSTANCE
    downSampling: heatmap
    sources:
      persistence_timer_bulk_execute_latency:
        counterFunction: INCREASE
        range: PT5M
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_persistence_timer_bulk_execute_latency_percentile
    scope: SERVICE_INSTANCE
    downSampling: percentile
    percentiles: [50, 70, 90, 99]
    sources:
      persistence_timer_bulk_execute_latency:
        counterFunction: INCREASE
        range: PT5M
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_persistence_timer_bulk_execute_latency
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      persistence_timer_bulk_execute_latency:
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_persistence_timer_bulk_prepare_latency
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      persistence_timer_bulk_prepare_latency:
        relabel:
          service:
            - app
          instance:
            - instance

  - name: instance_persistence_timer_bulk_error_count
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      persistence_timer_bulk_error_count:
        counterFunction: INCREASE
        range: PT1M
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_persistence_timer_bulk_execute_latency_count
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      persistence_timer_bulk_execute_latency_count:
        counterFunction: INCREASE
        range: PT1M
        relabel:
          service:
            - app
          instance:
            - instance
  - name: instance_persistence_timer_bulk_prepare_latency_count
    scope: SERVICE_INSTANCE
    downSampling: avg
    sources:
      persistence_timer_bulk_prepare_latency_count:
        counterFunction: INCREASE
        range: PT1M
        relabel:
          service:
            - app
          instance:
            - instance

